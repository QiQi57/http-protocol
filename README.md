# http2.0
### 1.特点：
更快，更简单，更健壮

通过支持请求与响应的多路复用来减少延迟，
通过压缩http首部字段将协议开销降至最低，
同时增加对请求优先级 和
服务器推送的支持。
HTTP 2.0还会给我们带来大量其它协议层面的辅助实现，比如 新的流量控制，错误处理和更新机制<br/>
总结：http2.0 通过支持首部字段压缩和在同一连接上发送多个并发消息，让应用更有效的利用网络资源，
减少感知延迟时间，而且还支持服务器到客户端的主动推送机制。


### 2.发展：
SPDY：二进制分帧数据层

### 3. http2.0
解决http中“队首阻塞”问题
并行操作无需与服务器建立多个连接，从而改进tcp的利用率，特别是拥塞控制方面

不变的功能：
http方法，状态码，uri和首部字段

递增到大版本http2.0 的原因：
改变了客户端和服务器之间交换数据的方式，http2.0增加了新的二进制分帧数据层 

### 4.http2.0的两个新的概念：
- 流：
已经建立连接上的双向字节流。
- 消息：
与逻辑消息对应的完整的一系列数据帧。
- 帧：
HTTP 2.0 通信的最小单位，每个帧包含帧首部，至少也会标识出当前帧所属的流。

所有http2.0的通信都在一个连接上完成的，这个连接可以承载任意数量的双向数据流。
每个数据流以消息的形式发送，而消息由一个或多个帧组成，这些帧可以乱序发送，然后在根据每个帧首部的流标识符重新组装。

流，消息和帧 总结：
所有通信都在一个tcp连接上完成
流是连接中的一个虚拟信道，可以承载双向的消息，每个流都有一个唯一的整数标记符
消息是指逻辑上的http消息，比如请求，响应等，由一个或多个帧组成。
帧是最小的通信单位，承载着特定类型的数据，如http首部，负荷，等。

### 5.优先级：
每个流都可以带有一个31 比特的优先值 <br/>
0 表示最高优先级<br/>
2的31次方 -1 表示最低优先级<br/>

服务器优先将最高优先级的帧发给客户端<br/>
http2.0没有规定处理优先级的具体算法；

### 6.每个来源一个连接
所有 HTTP 2.0 连接都是持久化 的，而且客户端与服务器之间也只需要一个连接即可。

优点：<br/>
一个连接减少了相关资源的占用，内存占用少了，连接吞吐量大了
由于tcp连接减少而使网络拥塞状况得以改观
慢启动时间少了，拥塞和丢包恢复速度更快
消除了http”队首阻塞“现象

缺点：<br/>
tcp层面仍然存在“队首阻塞”
如果tcp窗口缩放被禁用，会限制连接的吞吐量

### 7.流量控制
同一个tcp连接上传输多个数据流，就要共享带宽，http2.0提供流量控制的机制：
流量控制基于窗口更新帧进行，即接收方广播自己准备接收某个数据流的多少字节，以及整个连接要接收多少字节；
流量控制窗口大小通过WINDOW_UPDATE 帧更新，这个字段制定了流ID和窗口大小递增值。
接收方可以为每个流乃至整个连接设置任意窗口大小或禁用

 优先级可以确定交付次序，而流量控制可以 控制 HTTP 2.0 连接  中每个流占用的资源：接收方可以对特定的流广播较低的窗口大小
 ，以限制它的传输速度。

### 8.服务器推送
http2.0 ，服务器可以对一个客户端请求发送多个响应，额外的响应不需要客户端明确的请求。
备注：所有推送都遵守同源策略。第三方资源不能推送给客户端。
建立http2.0连接后，客户端和服务器交换SETTINGS帧，来限定双向并发的流的最大数量；如果设为0 会完全禁用服务器推送

PUSH_PROMISE，服务器向客户端发出有意推送资源的信号， 帧中只包含要约资源的http首部。

服务器推送限制：
只能接着请求的响应来推送资源，不能随意发起推送流。
PUSH_PROMISE 帧必须在返回响应之前发送，以免客户端出现竞态条件。（客户端请求的恰好就是服务器打算推送的资源）

推送策略，由各个应用／服务器自己实现

### 9.首部压缩
http每次通信都会携带一组首部，用于描述传输的资源及其属性。
http1.x 这些元数据以纯文本形式发送，通常会给每个请求增加500-800字节的负荷，算上http cookie，增加负荷达到上千字节。
http2.0 ：
在客户端和服务器端使用“首部表”（HEADERS） 来跟踪和存储之前发送的键值对，对于相同的数据，不再通过每次请求和响应发送。
首部表在http2.0的连续存续期内始终存在，有客户端和服务器共同渐进的更新
每个新的首部键值对要么被追加到当前表的末尾，要么替换表中之前的值。

http2.0 连续的两端都知道已经发送了哪些首部，从而可以针对之前的数据只编码发送差异数据。

### 10.http2.0 升级与兼容性
客户端使用HTTP Upgrade 机制通过协调确定适当的协议。

Upgrade：HTTP／2.0 <br/>
HTTP-Settings：（SETTINGS payload） <br/>

服务器拒绝升级，会通过http1.1 返回响应 <br/>

服务器接受HTTP2.0 升级，会切换到新的分帧 <br/>
HTTP／1.1 101 Switching Protocols <br/>
Connection：Upgrade <br/>
Upgrade：HTTP/2.0











